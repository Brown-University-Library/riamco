<%= render "results_javascript" %>
<%= render "search_box" %>

<div class="container-fluid results-page col-sm-12">
  <div class="row results-page-wrapper">
    <div class="results-wrapper col-lg-9 col-lg-push-3 col-md-9 col-md-push-3 col-sm-8 col-sm-push-4">
      <div class="result-nums-breadcrumbs-wrapper">
        <%= render "results_pagination_top" %>
        <%= render "results_search_terms" %>
      </div> <!-- result-nums-breadcrumbs-wrapper -->

      <h2 class="visible-print">Results</h2>

      <!-- search results -->
      <div class="row results-row col-lg-12 col-md-12 col-sm-12 col-xs-12">

        <% @presenter.results.each_with_index do |item, index| %>
            <!-- move out of here the logic to handle different
                 types of results (collections, series, items) -->
            <div style="padding-bottom:10px; padding-left: 15px;">
              <div class="result-title">
                  <a target="_blank", href="<%= ead_show_path() %>?eadid=<%=item.ead_id %>"><%= item.title %></a>
              </div>

              <% if @presenter.debug %>
                <div class="result-debug"><b>Format:</b> <%= item.inv_level %></div>
                <div class="result-debug"><b>Timestamp:</b> <%= item.timestamp %></div>
                <div class="result-debug"><b>Start Year:</b> <%= item.start_year %></div>
                <div class="result-debug"><b>End Year:</b> <%= item.end_year %></div>
                <div class="result-debug"><a target="_blank", href="<%= ead_download_path() %>?eadid=<%=item.ead_id %>">Download XML</a></div>
              <% end %>

              <% if item.institution_name  %>
                <div class="result"><b>Institution:</b> <%= item.institution_name %></div>
              <% end %>

              <% if item.extent %>
                <div class="result"><b>Extent:</b> <%= item.extent %></div>
              <% end %>

              <% if item.abstract %>
                <div class="result"><b>Abstract:</b> <%= item.abstract_hl.html_safe %></div>
              <% end %>

              <% if item.scope_content_hl? %>
                <div class="result"><b>Scope and Content:</b> <%= item.scope_content_hl.html_safe %></div>
              <% end %>

              <% if item.biog_hist_hl? %>
                <div class="result"><b>Biographical/Historical note:</b> <%= item.biog_hist_hl.html_safe %></div>
              <% end %>

              <% if item.subjects_hl? %>
                <div class="result"><b>Subjects:</b> <%= item.subjects_hl.html_safe %></div>
              <% end %>

              <% if item.repository %>
                <div class="result"><b>Repository:</b> <%= item.repository %></div>
              <% end %>

              <% if item.inv_container %>
                <div class="result">Container: <%= item.inv_container %></div>
              <% end %>

              <% if item.inv_label %>
                <div class="result">Label: <%= item.inv_label_hl.html_safe %></div>
              <% end %>

              <% if item.inv_date %>
                <div class="result">Date: <%= item.inv_date %></div>
              <% end %>

              <% if @presenter.empty_search? %>
                <div class="result"><i>(<%= item.match_count %> archival items)</i></div>
              <% else %>

                <% if item.children.count > 0 %>
                  <div class="result"><b>Inventory:</b></div>
                  <table class="table">
                  <% item.children.each do |inv_item| %>
                    <tr>
                      <td class="table_cell"><%= inv_item.inv_level %></td>
                      <td class="table_cell"><%= inv_item.inv_container %></td>
                      <td class="table_cell">
                        <%= inv_item.inv_scope_content_hl.html_safe %>
                        <%= inv_item.inv_label_hl.html_safe %>
                      </td>
                      <td class="table_cell"><%= inv_item.inv_date %></td>
                    </tr>
                  <% end %>
                  </table>
                  <% if item.match_count > 4 %>
                    <div class="result-bottom">
                      ...and <%= item.match_count-4 %> other <a target="_blank", href="render.php?eadid=<%=item.ead_id %>&view=inventory">matches</a>
                    </div>
                  <% end %>
                <% end %>

              <% end %>
            </div>
        <% end %>
      </div> <!-- row results-row col-lg-12 col-md-12 col-sm-12 col-xs-12 -->

      <%=render "results_pagination_bottom" %>

    </div> <!-- results-wrapper col-lg-9 col-lg-push-3 ... -->

    <% if @presenter.num_found > 0 %>
      <%= render "results_facets" %>
    <% end %>

  </div> <!-- row -->
</div> <!-- container-fluid col-sm-12 -->

<% if @presenter.explain_format != nil %>
  <%= render "explain_results" %>
<% end %>
